'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.version = undefined;
exports.makePromisedLock = makePromisedLock;

var _package = require('../package.json');

var version = exports.version = _package.version.split('.')[0];

function makePromisedLock(callback, keyCallback) {
  var progressMap = new Map();
  return function () {
    for (var _len = arguments.length, parameters = Array(_len), _key = 0; _key < _len; _key++) {
      parameters[_key] = arguments[_key];
    }

    var progressKey = keyCallback.apply(undefined, parameters);
    var progressStatus = Boolean(progressMap.get(progressKey));
    if (progressStatus) {
      return Promise.resolve(null);
    }
    progressMap.set(progressKey, true);
    return callback.apply(this, parameters).then(function (result) {
      progressMap.delete(progressKey);
      return result;
    }, function (error) {
      progressMap.delete(progressKey);
      throw error;
    });
  };
}